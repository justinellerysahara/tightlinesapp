        // Initialize app with proper event handlers
        function initializeApp() {
            // Set up form change handlers for all selects
            var selects = document.querySelectorAll('.form-select');
            selects.forEach(function(select) {
                select.addEventListener('change', updateRecommendations);
            });
            
            // Initial recommendations load
            updateRecommendations();
            
            // Update time display
            updateTime();
            setInterval(updateTime, 60000); // Update every minute
        }
        
        // Update current time
        function updateTime() {
            var now = new Date();
            var timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            var timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }
        
        //<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TightLines</title>
    <meta name="description" content="AI-powered fly fishing recommendations">
    
    <!-- iOS PWA Optimization -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TightLines">
    <meta name="theme-color" content="#047857">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><defs><linearGradient id='brand-bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23064e3b'/><stop offset='50%25' style='stop-color:%23047857'/><stop offset='100%25' style='stop-color:%23059669'/></linearGradient><linearGradient id='water-grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23059669'/><stop offset='100%25' style='stop-color:%2306b6d4'/></linearGradient></defs><rect width='180' height='180' fill='url(%23brand-bg)' rx='32'/><ellipse cx='90' cy='150' rx='70' ry='20' fill='url(%23water-grad)' opacity='0.7'/><g transform='translate(90,90)'><circle cx='0' cy='-25' r='8' fill='%23ffffff'/><rect x='-3' y='-17' width='6' height='25' fill='%23ffffff'/><rect x='-8' y='-5' width='16' height='6' fill='%23ffffff'/><rect x='-4' y='8' width='3' height='15' fill='%23ffffff'/><rect x='1' y='8' width='3' height='15' fill='%23ffffff'/><path d='M8 -5 Q35 -15 45 -10 Q50 -8 48 -5 Q40 0 35 5' stroke='%23fbbf24' stroke-width='2' fill='none'/><circle cx='45' cy='-10' r='1.5' fill='%23dc2626'/><path d='M-15 -5 L-25 -8 L-20 -3 Z' fill='%23fbbf24'/></g><text x='90' y='40' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-size='18' font-weight='700' fill='%23ffffff' text-anchor='middle' opacity='0.9'>TightLines</text></svg>">
    
    <!-- Manifest -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22TightLines%20-%20AI%20Fly%20Fishing%22,%22short_name%22:%22TightLines%22,%22description%22:%22AI-powered%20fly%20fishing%20recommendations%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f8fafc%22,%22theme_color%22:%22%23047857%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><defs><linearGradient id='brand-bg192' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23064e3b'/><stop offset='50%25' style='stop-color:%23047857'/><stop offset='100%25' style='stop-color:%23059669'/></linearGradient><linearGradient id='water-grad192' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23059669'/><stop offset='100%25' style='stop-color:%2306b6d4'/></linearGradient></defs><rect width='192' height='192' fill='url(%23brand-bg192)' rx='34'/><ellipse cx='96' cy='160' rx='75' ry='22' fill='url(%23water-grad192)' opacity='0.7'/><g transform='translate(96,96)'><circle cx='0' cy='-25' r='9' fill='%23ffffff'/><rect x='-3' y='-16' width='6' height='28' fill='%23ffffff'/><rect x='-9' y='-3' width='18' height='7' fill='%23ffffff'/><rect x='-4' y='12' width='3' height='16' fill='%23ffffff'/><rect x='1' y='12' width='3' height='16' fill='%23ffffff'/><path d='M9 -3 Q38 -16 50 -8 Q55 -5 52 -2 Q42 3 36 8' stroke='%23fbbf24' stroke-width='2.5' fill='none'/><circle cx='48' cy='-8' r='2' fill='%23dc2626'/><path d='M-16 -3 L-28 -7 L-22 -1 Z' fill='%23fbbf24'/></g><text x='96' y='42' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-size='19' font-weight='700' fill='%23ffffff' text-anchor='middle' opacity='0.9'>TightLines</text></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><defs><linearGradient id='brand-bg512' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23064e3b'/><stop offset='50%25' style='stop-color:%23047857'/><stop offset='100%25' style='stop-color:%23059669'/></linearGradient><linearGradient id='water-grad512' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23059669'/><stop offset='100%25' style='stop-color:%2306b6d4'/></linearGradient></defs><rect width='512' height='512' fill='url(%23brand-bg512)' rx='90'/><ellipse cx='256' cy='420' rx='200' ry='60' fill='url(%23water-grad512)' opacity='0.7'/><g transform='translate(256,256)'><circle cx='0' cy='-70' r='25' fill='%23ffffff'/><rect x='-8' y='-45' width='16' height='75' fill='%23ffffff'/><rect x='-25' y='-10' width='50' height='18' fill='%23ffffff'/><rect x='-12' y='30' width='8' height='45' fill='%23ffffff'/><rect x='4' y='30' width='8' height='45' fill='%23ffffff'/><path d='M25 -10 Q100 -40 135 -25 Q145 -15 140 -5 Q115 10 100 25' stroke='%23fbbf24' stroke-width='6' fill='none'/><circle cx='130' cy='-25' r='5' fill='%23dc2626'/><path d='M-45 -10 L-75 -20 L-60 -5 Z' fill='%23fbbf24'/></g><text x='256' y='110' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-size='50' font-weight='700' fill='%23ffffff' text-anchor='middle' opacity='0.9'>TightLines</text></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", Helvetica, Arial, sans-serif;
            background: #000000;
            color: #ffffff;
            line-height: 1.4;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: linear-gradient(180deg, #1a1a1a 0%, #000000 100%);
            position: relative;
        }

        /* Header with iOS-style design */
        .header {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: env(safe-area-inset-top, 44px) 20px 16px;
            border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo-subtitle {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .header-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }

        /* Modern tab navigation */
        .nav-tabs {
            display: flex;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            margin: 0 20px;
            border-radius: 16px;
            padding: 4px;
            margin-top: 16px;
            margin-bottom: 20px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            position: relative;
        }

        .nav-tab.active {
            color: #000000;
            background: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* Content area */
        .content {
            padding: 0 20px 40px;
            background: transparent;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modern card design */
        .card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #ffffff;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }

        .card-title {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.3px;
        }

        /* Photo upload with premium feel */
        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .upload-area {
            width: 100%;
            height: 120px;
            border: 2px dashed rgba(16, 185, 129, 0.5);
            border-radius: 16px;
            background: rgba(16, 185, 129, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-area:active {
            transform: scale(0.98);
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 20px;
            margin-bottom: 8px;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
        }

        .upload-text {
            font-size: 17px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .upload-subtext {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Analysis results */
        .analysis-results {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .analysis-results.show {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .analysis-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .analysis-title {
            font-size: 18px;
            font-weight: 700;
            color: #10b981;
        }

        .confidence-badge {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .analysis-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .analysis-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .analysis-value {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Form controls */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
        }

        .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 16px;
            color: #ffffff;
            background: rgba(26, 26, 26, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 44px;
        }

        .form-select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        /* Fly recommendations */
        .fly-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .fly-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .fly-item:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.05);
        }

        .fly-info {
            flex: 1;
        }

        .fly-name {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .fly-type {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .fly-favorite {
            width: 44px;
            height: 44px;
            border-radius: 22px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(26, 26, 26, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .fly-favorite:active {
            transform: scale(0.9);
        }

        .fly-favorite.active {
            background: rgba(251, 191, 36, 0.2);
            border-color: #fbbf24;
            color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        /* Conditions summary */
        .conditions-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: #ffffff;
            border-radius: 20px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 8px 32px rgba(5, 150, 105, 0.3);
        }

        .conditions-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 16px;
            letter-spacing: -0.3px;
        }

        .condition-item {
            font-size: 15px;
            margin-bottom: 8px;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Spot cards */
        .spot-card {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .spot-card:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.05);
        }

        .spot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .spot-name {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.3px;
        }

        .spot-rating {
            font-size: 15px;
            font-weight: 700;
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .spot-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .spot-species {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .spot-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .difficulty-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .difficulty-easy { 
            background: rgba(16, 185, 129, 0.2); 
            color: #10b981; 
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .difficulty-moderate { 
            background: rgba(251, 191, 36, 0.2); 
            color: #fbbf24; 
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        .difficulty-challenging { 
            background: rgba(239, 68, 68, 0.2); 
            color: #ef4444; 
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .navigate-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #ffffff;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }

        .navigate-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: #ffffff;
            font-size: 17px;
            font-weight: 600;
            text-align: center;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Safe area handling for newer iPhones */
        @supports (padding: max(0px)) {
            .app {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        /* Responsive optimizations */
        @media (max-width: 428px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        /* Hide scrollbars but keep functionality */
        .app::-webkit-scrollbar {
            display: none;
        }
        .app {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>b6d4'/></linearGradient></defs><rect width='180' height='180' fill='url(%23brand-bg)' rx='32'/><ellipse cx='90' cy='150' rx='70' ry='20' fill='url(%23water-grad)' opacity='0.7'/><g transform='translate(90,90)'><circle cx='0' cy='-25' r='8' fill='%23ffffff'/><rect x='-3' y='-17' width='6' height='25' fill='%23ffffff'/><rect x='-8' y='-5' width='16' height='6' fill='%23ffffff'/><rect x='-4' y='8' width='3' height='15' fill='%23ffffff'/><rect x='1' y='8' width='3' height='15' fill='%23ffffff'/><path d='M8 -5 Q35 -15 45 -10 Q50 -8 48 -5 Q40 0 35 5' stroke='%23fbbf24' stroke-width='2' fill='none'/><circle cx='45' cy='-10' r='1.5' fill='%23dc2626'/><path d='M-15 -5 L-25 -8 L-20 -3 Z' fill='%23fbbf24'/></g><text x='90' y='40' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-size='18' font-weight='700' fill='%23ffffff' text-anchor='middle' opacity='0.9'>TightLines</text></svg>">
    
    <!-- Manifest -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22TightLines%20-%20AI%20Fly%20Fishing%22,%22short_name%22:%22TightLines%22,%22description%22:%22AI-powered%20fly%20fishing%20recommendations%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23f8fafc%22,%22theme_color%22:%22%23047857%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><defs><linearGradient id='brand-bg192' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23064e3b'/><stop offset='50%25' style='stop-color:%23047857'/><stop offset='100%25' style='stop-color:%23059669'/></linearGradient><linearGradient id='water-grad192' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23059669'/><stop offset='100%25' style='stop-color:%2306b6d4'/></linearGradient></defs><rect width='192' height='192' fill='url(%23brand-bg192)' rx='34'/><ellipse cx='96' cy='160' rx='75' ry='22' fill='url(%23water-grad192)' opacity='0.7'/><g transform='translate(96,96)'><circle cx='0' cy='-25' r='9' fill='%23ffffff'/><rect x='-3' y='-16' width='6' height='28' fill='%23ffffff'/><rect x='-9' y='-3' width='18' height='7' fill='%23ffffff'/><rect x='-4' y='12' width='3' height='16' fill='%23ffffff'/><rect x='1' y='12' width='3' height='16' fill='%23ffffff'/><path d='M9 -3 Q38 -16 50 -8 Q55 -5 52 -2 Q42 3 36 8' stroke='%23fbbf24' stroke-width='2.5' fill='none'/><circle cx='48' cy='-8' r='2' fill='%23dc2626'/><path d='M-16 -3 L-28 -7 L-22 -1 Z' fill='%23fbbf24'/></g><text x='96' y='42' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-size='19' font-weight='700' fill='%23ffffff' text-anchor='middle' opacity='0.9'>TightLines</text></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><defs><linearGradient id='brand-bg512' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23064e3b'/><stop offset='50%25' style='stop-color:%23047857'/><stop offset='100%25' style='stop-color:%23059669'/></linearGradient><linearGradient id='water-grad512' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23059669'/><stop offset='100%25' style='stop-color:%2306b6d4'/></linearGradient></defs><rect width='512' height='512' fill='url(%23brand-bg512)' rx='90'/><ellipse cx='256' cy='420' rx='200' ry='60' fill='url(%23water-grad512)' opacity='0.7'/><g transform='translate(256,256)'><circle cx='0' cy='-70' r='25' fill='%23ffffff'/><rect x='-8' y='-45' width='16' height='75' fill='%23ffffff'/><rect x='-25' y='-10' width='50' height='18' fill='%23ffffff'/><rect x='-12' y='30' width='8' height='45' fill='%23ffffff'/><rect x='4' y='30' width='8' height='45' fill='%23ffffff'/><path d='M25 -10 Q100 -40 135 -25 Q145 -15 140 -5 Q115 10 100 25' stroke='%23fbbf24' stroke-width='6' fill='none'/><circle cx='130' cy='-25' r='5' fill='%23dc2626'/><path d='M-45 -10 L-75 -20 L-60 -5 Z' fill='%23fbbf24'/></g><text x='256' y='110' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-size='50' font-weight='700' fill='%23ffffff' text-anchor='middle' opacity='0.9'>TightLines</text></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">",<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><defs><linearGradient id='bg192' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%232563eb'/><stop offset='100%25' style='stop-color:%231d4ed8'/></linearGradient><linearGradient id='water192' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2306b6d4'/><stop offset='100%25' style='stop-color:%230891b2'/></linearGradient></defs><rect width='192' height='192' fill='url(%23bg192)' rx='30'/><circle cx='96' cy='140' r='38' fill='url(%23water192)' opacity='0.8'/><path d='M64 64 L128 64 L150 86 L128 108 L64 108 Z' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='2'/><circle cx='96' cy='86' r='9' fill='%23dc2626'/><path d='M96 76 Q102 68 114 74 Q108 80 102 76' fill='%23059669' stroke='%23047857' stroke-width='1'/></svg>%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><defs><linearGradient id='bg512' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%232563eb'/><stop offset='100%25' style='stop-color:%231d4ed8'/></linearGradient><linearGradient id='water512' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2306b6d4'/><stop offset='100%25' style='stop-color:%230891b2'/></linearGradient></defs><rect width='512' height='512' fill='url(%23bg512)' rx='80'/><circle cx='256' cy='370' r='100' fill='url(%23water512)' opacity='0.8'/><path d='M170 170 L342 170 L400 230 L342 290 L170 290 Z' fill='%23fbbf24' stroke='%23f59e0b' stroke-width='6'/><circle cx='256' cy='230' r='24' fill='%23dc2626'/><path d='M256 200 Q270 180 305 195 Q285 215 270 200' fill='%23059669' stroke='%23047857' stroke-width='3'/></svg>%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", Inter, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.5;
        }

        .app {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: #ffffff;
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
        }

        .header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 44px 20px 24px;
            border-bottom: 1px solid #e2e8f0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
        }

        .logo-subtitle {
            font-size: 13px;
            color: #64748b;
            font-weight: 500;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #475569;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .nav-tabs {
            display: flex;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
        }

        .nav-tab {
            flex: 1;
            padding: 16px 12px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .nav-tab:hover {
            color: #2563eb;
            background: #f8fafc;
        }

        .nav-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .content {
            padding: 0;
            background: #f8fafc;
        }

        .tab-content {
            display: none;
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            font-weight: 600;
        }

        .card-icon.blue { background: #3b82f6; }
        .card-icon.purple { background: #8b5cf6; }
        .card-icon.green { background: #10b981; }
        .card-icon.orange { background: #f59e0b; }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .upload-area {
            width: 100%;
            height: 120px;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .upload-icon {
            width: 40px;
            height: 40px;
            background: #3b82f6;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .upload-subtext {
            font-size: 14px;
            color: #64748b;
        }

        .analysis-results {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            display: none;
        }

        .analysis-results.show {
            display: block;
        }

        .analysis-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .analysis-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e40af;
        }

        .confidence-badge {
            background: #dcfce7;
            color: #166534;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .analysis-item {
            background: #ffffff;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .analysis-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .analysis-value {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            color: #1f2937;
            background: #ffffff;
            cursor: pointer;
        }

        .fly-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fly-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .fly-item:hover {
            background: #f1f5f9;
            transform: translateY(-1px);
        }

        .fly-info {
            flex: 1;
        }

        .fly-name {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 2px;
        }

        .fly-type {
            font-size: 13px;
            color: #64748b;
        }

        .fly-favorite {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #64748b;
            transition: all 0.2s ease;
        }

        .fly-favorite:hover {
            background: #fef3c7;
            border-color: #fbbf24;
            color: #d97706;
        }

        .fly-favorite.active {
            background: #fef3c7;
            border-color: #fbbf24;
            color: #d97706;
        }

        .conditions-card {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .conditions-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .condition-item {
            font-size: 14px;
            margin-bottom: 6px;
            opacity: 0.95;
        }

        .spot-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .spot-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .spot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .spot-name {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .spot-rating {
            font-size: 14px;
            font-weight: 600;
            color: #059669;
        }

        .spot-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #64748b;
        }

        .spot-species {
            font-size: 13px;
            color: #475569;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .spot-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .difficulty-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .difficulty-easy { background: #dcfce7; color: #166534; }
        .difficulty-moderate { background: #fef3c7; color: #92400e; }
        .difficulty-challenging { background: #fee2e2; color: #991b1b; }

        .navigate-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .navigate-btn:hover {
            background: #2563eb;
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: white;
            font-size: 16px;
            font-weight: 500;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 428px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="header-content">
                <div>
                    <div class="logo">TightLines</div>
                    <div class="logo-subtitle">AI Fly Fishing</div>
                </div>
                <div class="header-actions">
                    <button class="header-btn">⚙</button>
                    <button class="header-btn">☰</button>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('identify')">Identify</button>
            <button class="nav-tab" onclick="showTab('spots')">Spots</button>
            <button class="nav-tab" onclick="showTab('offline')">Offline</button>
        </div>

        <div class="content">
            <div id="identify-tab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon blue">AI</div>
                        <div class="card-title">Water Analysis</div>
                    </div>
                    
                    <div class="upload-options">
                        <div class="upload-area" onclick="document.getElementById('camera-input').click()">
                            <input type="file" id="camera-input" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoUpload(event)">
                            <div class="upload-icon">📷</div>
                            <div class="upload-text">Take Photo</div>
                            <div class="upload-subtext">Use camera</div>
                        </div>
                        
                        <div class="upload-area" onclick="document.getElementById('gallery-input').click()" style="margin-top: 12px;">
                            <input type="file" id="gallery-input" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                            <div class="upload-icon">🖼️</div>
                            <div class="upload-text">Choose Photo</div>
                            <div class="upload-subtext">From gallery</div>
                        </div>
                    </div>
                    
                    <div id="photo-preview" style="display: none; margin-top: 16px;">
                        <img id="captured-image" style="width: 100%; border-radius: 8px; border: 1px solid #e2e8f0;">
                    </div>

                    <div id="analysis-results" class="analysis-results">
                        <div class="analysis-header">
                            <div class="analysis-title">Analysis Complete</div>
                            <div class="confidence-badge">95% confident</div>
                        </div>
                        
                        <div class="analysis-grid">
                            <div class="analysis-item">
                                <div class="analysis-label">Water Type</div>
                                <div class="analysis-value">River</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">Clarity</div>
                                <div class="analysis-value">Clear</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">Weather</div>
                                <div class="analysis-value">Sunny</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">Season</div>
                                <div class="analysis-value">Spring</div>
                            </div>
                        </div>
                        
                        <div class="success-message">
                            <span>✓</span>
                            <span>Conditions auto-detected and applied</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon purple">⚙</div>
                        <div class="card-title">Manual Input</div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Season</label>
                            <select class="form-select" onchange="updateRecommendations()">
                                <option value="spring">Spring</option>
                                <option value="summer">Summer</option>
                                <option value="fall">Fall</option>
                                <option value="winter">Winter</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Water Type</label>
                            <select class="form-select" onchange="updateRecommendations()">
                                <option value="river">River</option>
                                <option value="lake">Lake</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Clarity</label>
                            <select class="form-select" onchange="updateRecommendations()">
                                <option value="clear">Clear</option>
                                <option value="murky">Murky</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Weather</label>
                            <select class="form-select" onchange="updateRecommendations()">
                                <option value="sunny">Sunny</option>
                                <option value="cloudy">Cloudy</option>
                                <option value="rainy">Rainy</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon green">★</div>
                        <div class="card-title">Recommended Flies</div>
                    </div>
                    
                    <div class="fly-list">
                        <div class="fly-item">
                            <div class="fly-info">
                                <div class="fly-name">Blue Winged Olive</div>
                                <div class="fly-type">Dry Fly</div>
                            </div>
                            <div class="fly-favorite" onclick="toggleFavorite(this)">☆</div>
                        </div>
                        <div class="fly-item">
                            <div class="fly-info">
                                <div class="fly-name">Pheasant Tail Nymph</div>
                                <div class="fly-type">Nymph</div>
                            </div>
                            <div class="fly-favorite" onclick="toggleFavorite(this)">☆</div>
                        </div>
                        <div class="fly-item">
                            <div class="fly-info">
                                <div class="fly-name">March Brown</div>
                                <div class="fly-type">Dry Fly</div>
                            </div>
                            <div class="fly-favorite" onclick="toggleFavorite(this)">☆</div>
                        </div>
                        <div class="fly-item">
                            <div class="fly-info">
                                <div class="fly-name">Woolly Bugger</div>
                                <div class="fly-type">Streamer</div>
                            </div>
                            <div class="fly-favorite" onclick="toggleFavorite(this)">☆</div>
                        </div>
                    </div>
                </div>

                <div class="conditions-card">
                    <div class="conditions-title">Current Conditions</div>
                    <div>
                        <div class="condition-item">Season: Spring</div>
                        <div class="condition-item">Water: River (clear)</div>
                        <div class="condition-item">Weather: Sunny</div>
                        <div class="condition-item">Time: 2:30 PM</div>
                    </div>
                </div>
            </div>

            <div id="spots-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon blue">📍</div>
                        <div class="card-title">Nearby Waters</div>
                    </div>
                    
                    <div class="spot-card">
                        <div class="spot-header">
                            <div class="spot-name">Kicking Horse River</div>
                            <div class="spot-rating">★ 4.6</div>
                        </div>
                        <div class="spot-details">
                            <div>River</div>
                            <div>2.1 km away</div>
                        </div>
                        <div class="spot-species">
                            <strong>Species:</strong> Rainbow Trout, Bull Trout, Mountain Whitefish<br>
                            <strong>Season:</strong> May to October
                        </div>
                        <div class="spot-actions">
                            <div class="difficulty-badge difficulty-moderate">Moderate</div>
                            <button class="navigate-btn" onclick="navigateToSpot('Kicking Horse River')">Navigate</button>
                        </div>
                    </div>
                    
                    <div class="spot-card">
                        <div class="spot-header">
                            <div class="spot-name">Columbia River</div>
                            <div class="spot-rating">★ 4.4</div>
                        </div>
                        <div class="spot-details">
                            <div>River</div>
                            <div>3.8 km away</div>
                        </div>
                        <div class="spot-species">
                            <strong>Species:</strong> Rainbow Trout, Bull Trout, Kokanee<br>
                            <strong>Season:</strong> Year-round
                        </div>
                        <div class="spot-actions">
                            <div class="difficulty-badge difficulty-easy">Easy</div>
                            <button class="navigate-btn" onclick="navigateToSpot('Columbia River')">Navigate</button>
                        </div>
                    </div>
                    
                    <div class="spot-card">
                        <div class="spot-header">
                            <div class="spot-name">Blaeberry River</div>
                            <div class="spot-rating">★ 4.7</div>
                        </div>
                        <div class="spot-details">
                            <div>River</div>
                            <div>8.2 km away</div>
                        </div>
                        <div class="spot-species">
                            <strong>Species:</strong> Bull Trout, Rainbow Trout<br>
                            <strong>Season:</strong> June to September
                        </div>
                        <div class="spot-actions">
                            <div class="difficulty-badge difficulty-challenging">Challenging</div>
                            <button class="navigate-btn" onclick="navigateToSpot('Blaeberry River')">Navigate</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="offline-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon orange">⬇</div>
                        <div class="card-title">Download Regions</div>
                    </div>
                    
                    <div class="spot-card">
                        <div class="spot-header">
                            <div class="spot-name">BC Rocky Mountains</div>
                            <div class="spot-rating">25 MB</div>
                        </div>
                        <div class="spot-details">
                            <div>47 fishing spots</div>
                            <div>Complete offline maps</div>
                        </div>
                        <div class="spot-species">
                            Includes Kicking Horse, Columbia, and Blaeberry rivers with fly recommendations and species info.
                        </div>
                        <div class="spot-actions">
                            <div class="difficulty-badge difficulty-easy">Ready</div>
                            <button class="navigate-btn" onclick="downloadRegion('BC Rocky Mountains')">Download</button>
                        </div>
                    </div>
                    
                    <div class="spot-card">
                        <div class="spot-header">
                            <div class="spot-name">Columbia Valley</div>
                            <div class="spot-rating">18 MB</div>
                        </div>
                        <div class="spot-details">
                            <div>32 fishing spots</div>
                            <div>Lakes and rivers</div>
                        </div>
                        <div class="spot-species">
                            Windermere, Fairmont, and Canal Flats area with complete offline functionality.
                        </div>
                        <div class="spot-actions">
                            <div class="difficulty-badge difficulty-easy">Ready</div>
                            <button class="navigate-btn" onclick="downloadRegion('Columbia Valley')">Download</button>
                        </div>
                    </div>
                    
                    <div class="spot-card">
                        <div class="spot-header">
                            <div class="spot-name">Glacier National Park</div>
                            <div class="spot-rating">32 MB</div>
                        </div>
                        <div class="spot-details">
                            <div>28 fishing spots</div>
                            <div>Alpine lakes & streams</div>
                        </div>
                        <div class="spot-species">
                            Remote alpine fishing locations with detailed access maps and regulations.
                        </div>
                        <div class="spot-actions">
                            <div class="difficulty-badge difficulty-challenging">Ready</div>
                            <button class="navigate-btn" onclick="downloadRegion('Glacier National Park')">Download</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading-overlay" id="loading-overlay">
            <div class="spinner"></div>
            <div class="loading-text">Analyzing water conditions...</div>
        </div>
    </div>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                    const CACHE_NAME = 'tightlines-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `))
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
            });
        }

        // Simple tab switching
        function showTab(tabName) {
            // Hide all tabs
            var tabs = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Remove active from nav tabs
            var navTabs = document.querySelectorAll('.nav-tab');
            for (var i = 0; i < navTabs.length; i++) {
                navTabs[i].classList.remove('active');
            }
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Activate nav tab
            event.target.classList.add('active');
        }

        // Photo upload handler
        function handlePhotoUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            var reader = new FileReader();
            reader.onload = function(e) {
                // Show photo preview
                var preview = document.getElementById('photo-preview');
                var img = document.getElementById('captured-image');
                img.src = e.target.result;
                preview.style.display = 'block';
                
                // Start analysis
                analyzePhoto();
            };
            reader.readAsDataURL(file);
        }
        
        // Photo analysis with updated recommendations
        function analyzePhoto() {
            var loading = document.getElementById('loading-overlay');
            var results = document.getElementById('analysis-results');
            
            loading.classList.add('show');
            
            setTimeout(function() {
                loading.classList.remove('show');
                
                // Mock analysis results (randomized for realism)
                var seasons = ['spring', 'summer', 'fall', 'winter'];
                var waterTypes = ['river', 'lake'];
                var clarities = ['clear', 'murky'];
                var weathers = ['sunny', 'cloudy', 'rainy'];
                
                var mockResults = {
                    season: seasons[Math.floor(Math.random() * seasons.length)],
                    waterType: waterTypes[Math.floor(Math.random() * waterTypes.length)],
                    clarity: clarities[Math.floor(Math.random() * clarities.length)],
                    weather: weathers[Math.floor(Math.random() * weathers.length)]
                };
                
                // Update detection display
                document.getElementById('detected-water-type').textContent = capitalizeFirst(mockResults.waterType);
                document.getElementById('detected-clarity').textContent = capitalizeFirst(mockResults.clarity);
                document.getElementById('detected-weather').textContent = capitalizeFirst(mockResults.weather);
                document.getElementById('detected-season').textContent = capitalizeFirst(mockResults.season);
                
                // Update form selects
                document.getElementById('season-select').value = mockResults.season;
                document.getElementById('water-type-select').value = mockResults.waterType;
                document.getElementById('clarity-select').value = mockResults.clarity;
                document.getElementById('weather-select').value = mockResults.weather;
                
                // Show results
                results.classList.add('show');
                
                // Update recommendations with new conditions
                updateRecommendations();
                
            }, 2000);
        }

        // Photo upload simulation (fallback)
        function simulatePhotoUpload() {
            document.getElementById('camera-input').click();
        }

        // Toggle favorite
        function toggleFavorite(element) {
            if (element.classList.contains('active')) {
                element.classList.remove('active');
                element.textContent = '☆';
            } else {
                element.classList.add('active');
                element.textContent = '★';
            }
        }

        // Update recommendations (now actually functional)
        function updateRecommendations() {
            var season = document.getElementById('season-select').value;
            var waterType = document.getElementById('water-type-select').value;
            var clarity = document.getElementById('clarity-select').value;
            var weather = document.getElementById('weather-select').value;
            
            var flies = getFlyRecommendations(season, waterType, clarity, weather);
            
            var flyList = document.querySelector('.fly-list');
            flyList.innerHTML = '';
            
            flies.forEach(function(fly) {
                var flyItem = document.createElement('div');
                flyItem.className = 'fly-item';
                flyItem.innerHTML = 
                    '<div class="fly-info">' +
                        '<div class="fly-name">' + fly.name + '</div>' +
                        '<div class="fly-type">' + fly.type + '</div>' +
                    '</div>' +
                    '<div class="fly-favorite" onclick="toggleFavorite(this)">☆</div>';
                flyList.appendChild(flyItem);
            });
            
            updateConditionsSummary(season, waterType, clarity, weather);
        }

        // Comprehensive fly database with accurate recommendations
        function getFlyRecommendations(season, waterType, clarity, weather) {
            var flyDatabase = {
                spring: {
                    river: {
                        clear: {
                            sunny: [
                                { name: 'Blue Winged Olive', type: 'Dry Fly' },
                                { name: 'Pheasant Tail Nymph', type: 'Nymph' },
                                { name: 'March Brown', type: 'Dry Fly' },
                                { name: 'Hare\'s Ear Nymph', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Adams', type: 'Dry Fly' },
                                { name: 'Elk Hair Caddis', type: 'Dry Fly' },
                                { name: 'Prince Nymph', type: 'Nymph' },
                                { name: 'Copper John', type: 'Nymph' }
                            ],
                            rainy: [
                                { name: 'San Juan Worm', type: 'Nymph' },
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Egg Pattern', type: 'Nymph' },
                                { name: 'Zebra Midge', type: 'Nymph' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Stimulator', type: 'Dry Fly' },
                                { name: 'Clouser Minnow', type: 'Streamer' },
                                { name: 'Bead Head Prince', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Woolly Worm', type: 'Nymph' },
                                { name: 'Leech Pattern', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Streamer Variety', type: 'Streamer' },
                                { name: 'Large Woolly Bugger', type: 'Streamer' },
                                { name: 'Cone Head Woolly Bugger', type: 'Streamer' },
                                { name: 'Sculpin Pattern', type: 'Streamer' }
                            ]
                        }
                    },
                    lake: {
                        clear: {
                            sunny: [
                                { name: 'Chironomid', type: 'Nymph' },
                                { name: 'Damselfly Nymph', type: 'Nymph' },
                                { name: 'Callibaetis', type: 'Dry Fly' },
                                { name: 'Scud', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Dragon Fly Nymph', type: 'Nymph' },
                                { name: 'Mayfly Emerger', type: 'Emerger' },
                                { name: 'Boatman', type: 'Nymph' },
                                { name: 'Sedge Pupa', type: 'Emerger' }
                            ],
                            rainy: [
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Carey Special', type: 'Wet Fly' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Dragon Fly', type: 'Nymph' },
                                { name: 'Boatman', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Carey Special', type: 'Wet Fly' },
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Zonker', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Large Leech', type: 'Streamer' },
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Bunny Leech', type: 'Streamer' },
                                { name: 'Marabou Leech', type: 'Streamer' }
                            ]
                        }
                    }
                },
                summer: {
                    river: {
                        clear: {
                            sunny: [
                                { name: 'Pale Morning Dun', type: 'Dry Fly' },
                                { name: 'Caddis', type: 'Dry Fly' },
                                { name: 'Grasshopper', type: 'Dry Fly' },
                                { name: 'Ant Pattern', type: 'Dry Fly' }
                            ],
                            cloudy: [
                                { name: 'Blue Winged Olive', type: 'Dry Fly' },
                                { name: 'Beetle', type: 'Dry Fly' },
                                { name: 'Caddis Emerger', type: 'Emerger' },
                                { name: 'Pheasant Tail', type: 'Nymph' }
                            ],
                            rainy: [
                                { name: 'Stimulator', type: 'Dry Fly' },
                                { name: 'Royal Wulff', type: 'Dry Fly' },
                                { name: 'Elk Hair Caddis', type: 'Dry Fly' },
                                { name: 'Woolly Bugger', type: 'Streamer' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Hopper Pattern', type: 'Dry Fly' },
                                { name: 'Stimulator', type: 'Dry Fly' }
                            ],
                            cloudy: [
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Clouser Minnow', type: 'Streamer' },
                                { name: 'Cone Head Bugger', type: 'Streamer' },
                                { name: 'Sculpin', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'San Juan Worm', type: 'Nymph' },
                                { name: 'Prince Nymph', type: 'Nymph' },
                                { name: 'Hare\'s Ear', type: 'Nymph' },
                                { name: 'Woolly Bugger', type: 'Streamer' }
                            ]
                        }
                    },
                    lake: {
                        clear: {
                            sunny: [
                                { name: 'Callibaetis', type: 'Dry Fly' },
                                { name: 'Damsel Adult', type: 'Dry Fly' },
                                { name: 'Chironomid Emerger', type: 'Emerger' },
                                { name: 'Scud', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Boatman', type: 'Nymph' },
                                { name: 'Sedge Adult', type: 'Dry Fly' },
                                { name: 'Dragon Fly', type: 'Nymph' },
                                { name: 'Leech', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Muddler', type: 'Streamer' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Carey Special', type: 'Wet Fly' },
                                { name: 'Doc Spratley', type: 'Wet Fly' }
                            ],
                            cloudy: [
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Bunny Leech', type: 'Streamer' },
                                { name: 'Marabou Muddler', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Large Bugger', type: 'Streamer' },
                                { name: 'Cone Head Leech', type: 'Streamer' },
                                { name: 'Woolly Worm', type: 'Nymph' },
                                { name: 'Dragon Fly', type: 'Nymph' }
                            ]
                        }
                    }
                },
                fall: {
                    river: {
                        clear: {
                            sunny: [
                                { name: 'Blue Winged Olive', type: 'Dry Fly' },
                                { name: 'October Caddis', type: 'Dry Fly' },
                                { name: 'Pheasant Tail', type: 'Nymph' },
                                { name: 'Stimulator', type: 'Dry Fly' }
                            ],
                            cloudy: [
                                { name: 'Adams', type: 'Dry Fly' },
                                { name: 'Prince Nymph', type: 'Nymph' },
                                { name: 'Hare\'s Ear', type: 'Nymph' },
                                { name: 'Caddis Emerger', type: 'Emerger' }
                            ],
                            rainy: [
                                { name: 'San Juan Worm', type: 'Nymph' },
                                { name: 'Egg Pattern', type: 'Nymph' },
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Zebra Midge', type: 'Nymph' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Egg Pattern', type: 'Nymph' },
                                { name: 'Streamer', type: 'Streamer' },
                                { name: 'October Caddis', type: 'Dry Fly' }
                            ],
                            cloudy: [
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Clouser Minnow', type: 'Streamer' },
                                { name: 'Sculpin', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Woolly Worm', type: 'Nymph' },
                                { name: 'Prince Nymph', type: 'Nymph' },
                                { name: 'Hare\'s Ear', type: 'Nymph' },
                                { name: 'Large Egg', type: 'Nymph' }
                            ]
                        }
                    },
                    lake: {
                        clear: {
                            sunny: [
                                { name: 'Chironomid', type: 'Nymph' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Scud', type: 'Nymph' },
                                { name: 'Boatman', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Dragon Fly Nymph', type: 'Nymph' },
                                { name: 'Damsel Nymph', type: 'Nymph' },
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Carey Special', type: 'Wet Fly' }
                            ],
                            rainy: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Muddler', type: 'Streamer' },
                                { name: 'Zonker', type: 'Streamer' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Carey Special', type: 'Wet Fly' }
                            ],
                            cloudy: [
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Bunny Leech', type: 'Streamer' },
                                { name: 'Marabou Leech', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Large Leech', type: 'Streamer' },
                                { name: 'Cone Head Bugger', type: 'Streamer' },
                                { name: 'Woolly Worm', type: 'Nymph' },
                                { name: 'Dragon Fly', type: 'Nymph' }
                            ]
                        }
                    }
                },
                winter: {
                    river: {
                        clear: {
                            sunny: [
                                { name: 'Midge', type: 'Dry Fly' },
                                { name: 'San Juan Worm', type: 'Nymph' },
                                { name: 'Zebra Midge', type: 'Nymph' },
                                { name: 'Pheasant Tail', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Prince Nymph', type: 'Nymph' },
                                { name: 'Hare\'s Ear', type: 'Nymph' },
                                { name: 'Copper John', type: 'Nymph' },
                                { name: 'Bead Head Nymph', type: 'Nymph' }
                            ],
                            rainy: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Egg Pattern', type: 'Nymph' },
                                { name: 'Large San Juan', type: 'Nymph' },
                                { name: 'Streamer', type: 'Streamer' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Egg Pattern', type: 'Nymph' },
                                { name: 'Large Nymph', type: 'Nymph' }
                            ],
                            cloudy: [
                                { name: 'Streamer', type: 'Streamer' },
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Clouser Minnow', type: 'Streamer' },
                                { name: 'Sculpin', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Woolly Worm', type: 'Nymph' },
                                { name: 'Prince Nymph', type: 'Nymph' },
                                { name: 'San Juan Worm', type: 'Nymph' },
                                { name: 'Bead Head Prince', type: 'Nymph' }
                            ]
                        }
                    },
                    lake: {
                        clear: {
                            sunny: [
                                { name: 'Chironomid', type: 'Nymph' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Scud', type: 'Nymph' },
                                { name: 'Midge Emerger', type: 'Emerger' }
                            ],
                            cloudy: [
                                { name: 'Dragon Fly Nymph', type: 'Nymph' },
                                { name: 'Boatman', type: 'Nymph' },
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Leech', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Muddler', type: 'Streamer' },
                                { name: 'Carey Special', type: 'Wet Fly' }
                            ]
                        },
                        murky: {
                            sunny: [
                                { name: 'Leech', type: 'Streamer' },
                                { name: 'Woolly Bugger', type: 'Streamer' },
                                { name: 'Doc Spratley', type: 'Wet Fly' },
                                { name: 'Carey Special', type: 'Wet Fly' }
                            ],
                            cloudy: [
                                { name: 'Muddler Minnow', type: 'Streamer' },
                                { name: 'Zonker', type: 'Streamer' },
                                { name: 'Bunny Leech', type: 'Streamer' },
                                { name: 'Marabou Leech', type: 'Streamer' }
                            ],
                            rainy: [
                                { name: 'Large Leech', type: 'Streamer' },
                                { name: 'Cone Head Bugger', type: 'Streamer' },
                                { name: 'Woolly Worm', type: 'Nymph' },
                                { name: 'Dragon Fly', type: 'Nymph' }
                            ]
                        }
                    }
                }
            };
            
            return flyDatabase[season]?.[waterType]?.[clarity]?.[weather] || [
                { name: 'Woolly Bugger', type: 'Streamer' },
                { name: 'Pheasant Tail Nymph', type: 'Nymph' },
                { name: 'Adams', type: 'Dry Fly' },
                { name: 'Prince Nymph', type: 'Nymph' }
            ];
        }

        // Update conditions summary
        function updateConditionsSummary(season, waterType, clarity, weather) {
            var container = document.getElementById('conditions-summary');
            var now = new Date();
            var timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            container.innerHTML = 
                '<div class="condition-item">Season: ' + capitalizeFirst(season) + '</div>' +
                '<div class="condition-item">Water: ' + capitalizeFirst(waterType) + ' (' + clarity + ')</div>' +
                '<div class="condition-item">Weather: ' + capitalizeFirst(weather) + '</div>' +
                '<div class="condition-item">Time: ' + timeString + '</div>';
        }

        // Navigate to spot with Google Maps integration
        function navigateToSpot(spotName) {
            var coordinates = {
                'Kicking Horse River': '51.4968,-116.4719',
                'Columbia River': '51.1784,-116.5040', 
                'Blaeberry River': '51.8445,-116.7089'
            };
            
            var coords = coordinates[spotName];
            if (coords) {
                var googleMapsUrl = 'https://www.google.com/maps/dir/?api=1&destination=' + coords + '&destination_place_id=' + encodeURIComponent(spotName);
                window.open(googleMapsUrl, '_blank');
            } else {
                alert('Navigation coordinates not available for ' + spotName);
            }
        }

        // Download region with working file download
        function downloadRegion(regionName) {
            var loadingOverlay = document.getElementById('loading-overlay');
            var loadingText = document.querySelector('.loading-text');
            
            // Show loading
            loadingText.textContent = 'Preparing download for ' + regionName + '...';
            loadingOverlay.classList.add('show');
            
            // Create the offline data
            var offlineData = {
                region: regionName,
                downloadDate: new Date().toLocaleDateString(),
                downloadTime: new Date().toLocaleTimeString(),
                fishingSpots: [
                    "Kicking Horse River - GPS: 51.4968,-116.4719",
                    "Columbia River - GPS: 51.1784,-116.5040", 
                    "Blaeberry River - GPS: 51.8445,-116.7089"
                ],
                flyRecommendations: {
                    spring: "Blue Winged Olive, Pheasant Tail Nymph, March Brown",
                    summer: "Pale Morning Dun, Caddis, Grasshopper",
                    fall: "October Caddis, Adams, Prince Nymph",
                    winter: "Midge, San Juan Worm, Zebra Midge"
                },
                offlineInstructions: "This file contains your offline fishing data for " + regionName + ". Keep this file accessible when fishing in areas without internet connection.",
                mapInformation: "GPS coordinates included for offline navigation. Use with your device's built-in GPS and maps app.",
                regulations: "Always check current local fishing regulations before fishing.",
                fileSize: "Complete offline package ready for use"
            };
            
            // Convert to readable text format
            var fileContent = "=== TIGHTLINES OFFLINE FISHING DATA ===\n\n";
            fileContent += "Region: " + offlineData.region + "\n";
            fileContent += "Downloaded: " + offlineData.downloadDate + " at " + offlineData.downloadTime + "\n\n";
            fileContent += "=== FISHING SPOTS ===\n";
            offlineData.fishingSpots.forEach(function(spot) {
                fileContent += "• " + spot + "\n";
            });
            fileContent += "\n=== FLY RECOMMENDATIONS ===\n";
            fileContent += "Spring: " + offlineData.flyRecommendations.spring + "\n";
            fileContent += "Summer: " + offlineData.flyRecommendations.summer + "\n";
            fileContent += "Fall: " + offlineData.flyRecommendations.fall + "\n";
            fileContent += "Winter: " + offlineData.flyRecommendations.winter + "\n\n";
            fileContent += "=== INSTRUCTIONS ===\n";
            fileContent += offlineData.offlineInstructions + "\n\n";
            fileContent += offlineData.mapInformation + "\n\n";
            fileContent += "=== REGULATIONS ===\n";
            fileContent += offlineData.regulations + "\n\n";
            fileContent += "Generated by TightLines App - AI Fly Fishing Assistant";
            
            // Simulate download time
            setTimeout(function() {
                try {
                    // Create and trigger download
                    var element = document.createElement('a');
                    var file = new Blob([fileContent], {type: 'text/plain'});
                    element.href = URL.createObjectURL(file);
                    element.download = regionName.replace(/\s+/g, '_') + '_Fishing_Guide.txt';
                    
                    // Force download
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                    
                    // Clean up
                    URL.revokeObjectURL(element.href);
                    
                    // Hide loading
                    loadingOverlay.classList.remove('show');
                    
                    // Update button
                    updateDownloadButton(regionName);
                    
                    // Success message
                    alert('✅ Download Complete!\n\n' +
                          'File: ' + regionName.replace(/\s+/g, '_') + '_Fishing_Guide.txt\n' +
                          'Location: Your Downloads folder\n\n' +
                          '📁 Check your Downloads folder for the complete fishing guide!');
                    
                } catch (error) {
                    loadingOverlay.classList.remove('show');
                    alert('❌ Download failed. Please try again or check your browser settings.');
                    console.error('Download error:', error);
                }
            }, 2000);
        }
        
        // Update download button after successful download
        function updateDownloadButton(regionName) {
            var downloadButtons = document.querySelectorAll('.navigate-btn');
            downloadButtons.forEach(function(btn) {
                var spotCard = btn.closest('.spot-card');
                if (spotCard && spotCard.querySelector('.spot-name').textContent === regionName && btn.textContent === 'Download') {
                    btn.textContent = 'Downloaded ✓';
                    btn.style.background = '#059669';
                    btn.style.cursor = 'default';
                    btn.onclick = function() { 
                        alert('✅ Region already downloaded!\n\nCheck your Downloads folder for:\n' + regionName.replace(/\s+/g, '_') + '_Fishing_Guide.txt'); 
                    };
                }
            });
        }
    </script>
</body>
</html>